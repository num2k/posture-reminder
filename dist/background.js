(()=>{var c={interval:30,notifications:!0,exercises:!0,language:"en",categories:{neck:!0,shoulder:!0,back:!0,wrist:!0,eye:!0}},l="postureReminderAlarm",y={en:{title:"Posture Reminder",breakTime:"Break Time",breakTimeDesc:"Take a short break and do some stretching!",remindLater:"Remind in 5 minutes",stretchNow:"Stretch now"},ko:{title:"\uC790\uC138 \uC54C\uB9BC\uC774",breakTime:"\uD734\uC2DD \uC2DC\uAC04",breakTimeDesc:"\uC7A0\uC2DC \uD734\uC2DD\uC744 \uCDE8\uD558\uACE0 \uC2A4\uD2B8\uB808\uCE6D\uC744 \uD574\uBCF4\uC138\uC694!",remindLater:"5\uBD84 \uD6C4\uC5D0 \uC54C\uB9BC",stretchNow:"\uC9C0\uAE08 \uC2A4\uD2B8\uB808\uCE6D"}},h=[];function a(e,t){return(!t||!y[t])&&(t="en"),y[t][e]||y.en[e]}function M(){chrome.storage.sync.get(["settings"],function(e){let o=((e.settings||c).language||"en")==="ko"?"data/exercises_kr.json":"data/exercises.json";fetch(o).then(s=>s.json()).then(s=>{h=s}).catch(s=>console.error("Failed to fetch exercise data:",s))})}function p(){chrome.storage.sync.get(["settings"],function(e){let t=e.settings||c;f(t.interval)}),M()}function f(e){chrome.alarms.clear(l,()=>{chrome.alarms.create(l,{delayInMinutes:e,periodInMinutes:e}),console.log(`Alarm set at ${e} minute intervals.`)})}function T(e){chrome.alarms.clear(l,()=>{chrome.storage.sync.get(["settings"],function(t){let o=(t.settings||c).interval;chrome.alarms.create(l,{delayInMinutes:e,periodInMinutes:o}),console.log(`Alarm set to resume in ${e.toFixed(2)} minutes, then repeat every ${o} minutes.`)})})}chrome.alarms.onAlarm.addListener(e=>{e.name===l&&chrome.storage.sync.get(["settings"],function(t){let n=t.settings||c;if(n.isPaused){console.log("\uC77C\uC2DC \uC815\uC9C0 \uC0C1\uD0DC\uC774\uBBC0\uB85C \uC54C\uB9BC\uC744 \uD45C\uC2DC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return}if(n.notifications){if(n.workHoursOnly&&!b(n.workStart,n.workEnd)){console.log("\uD604\uC7AC \uC2DC\uAC04\uC774 \uADFC\uBB34 \uC2DC\uAC04\uC774 \uC544\uB2C8\uBBC0\uB85C \uC54C\uB9BC\uC744 \uD45C\uC2DC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return}$(n)}})});function b(e,t){let n=new Date,o=n.getHours(),s=n.getMinutes(),[u,g]=e.split(":").map(Number),[m,r]=t.split(":").map(Number),i=o*60+s,d=u*60+g,k=m*60+r;return i>=d&&i<=k}function $(e){let t=e.language||"en",n={title:a("breakTime",t),description:a("breakTimeDesc",t)};if(console.log("\uC2A4\uD2B8\uB808\uCE6D \uC6B4\uB3D9 \uC124\uC815:",e.exercises),console.log("\uB85C\uB4DC\uB41C \uC6B4\uB3D9 \uB370\uC774\uD130:",h.length),e.exercises&&h.length>0){let r=h.filter(i=>{let d=e.categories||c.categories;return console.log(`\uCE74\uD14C\uACE0\uB9AC \uCCB4\uD06C: ${i.category} - ${d[i.category]}`),d[i.category]===!0});if(console.log(`\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC6B4\uB3D9 \uC218: ${r.length}`),r.length===0)console.log("No exercises available in selected categories. Using default message.");else{let i=Math.floor(Math.random()*r.length);n=r[i],console.log(`Selected exercise: ${n.title} (${n.category})`)}}let s=(e.interval*60+5)*1e3,u="posture-reminder-"+Date.now();chrome.notifications.create(u,{type:"basic",iconUrl:"assets/images/icon128.png",title:a("title",t),message:`${n.title}: ${n.description}`,priority:2,buttons:[{title:a("remindLater",t)},{title:a("stretchNow",t)}],requireInteraction:!0,silent:!0});let g=Math.floor(s/6e4),m=Math.floor(s%6e4/1e3);console.log(`Notification should display for ${g}m ${m}s (${e.interval} minute interval + 5 seconds)`),setTimeout(()=>{chrome.notifications.clear(u),console.log(`Notification manually closed after ${g}m ${m}s`)},s)}chrome.notifications.onButtonClicked.addListener((e,t)=>{t===0?f(5):chrome.tabs.create({url:"popup/stretching_guide.html"}),chrome.notifications.clear(e)});chrome.storage.onChanged.addListener((e,t)=>{var n;if(t==="sync"&&e.settings){let o=e.settings.newValue;f(o.interval),((n=e.settings.oldValue)==null?void 0:n.language)!==o.language&&M()}});chrome.runtime.onMessage.addListener(e=>{e.action==="resetAlarm"?chrome.storage.sync.get(["settings"],function(t){let n=t.settings||c;f(n.interval)}):e.action==="resumeAlarm"&&e.delayInMinutes&&T(e.delayInMinutes)});p();})();
