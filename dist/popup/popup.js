(()=>{var G=Object.defineProperty;var C=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var S=(e,t,n)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))Z.call(t,n)&&S(e,n,t[n]);if(C)for(var n of C(t))z.call(t,n)&&S(e,n,t[n]);return e};var b=(e,t,n)=>new Promise((u,a)=>{var y=i=>{try{E(n.next(i))}catch(k){a(k)}},_=i=>{try{E(n.throw(i))}catch(k){a(k)}},E=i=>i.done?u(i.value):Promise.resolve(i.value).then(y,_);E((n=n.apply(e,t)).next())});var I=document.getElementById("next-reminder"),c=document.getElementById("pause-btn"),L=document.getElementById("reset-btn"),T=document.getElementById("interval-select"),J=document.getElementById("tip-title"),K=document.getElementById("tip-description"),l=document.getElementById("custom-interval"),m=document.querySelectorAll(".interval-preset"),A=document.getElementById("notifications-toggle"),P=document.getElementById("exercises-toggle"),$=document.querySelectorAll(".category-item input"),D=document.getElementById("work-start"),O=document.getElementById("work-end"),F=document.getElementById("work-hours-only"),v=document.getElementById("language-select"),r=document.getElementById("save-btn"),g=document.getElementById("reset-btn-options"),M=document.querySelectorAll(".tab-button"),Q=document.querySelectorAll(".tab-content"),p={interval:30,notifications:!0,exercises:!0,language:"en",categories:{neck:!0,shoulder:!0,back:!0,wrist:!0,eye:!0,arm:!0},workStart:"09:00",workEnd:"18:00",workHoursOnly:!1,isPaused:!1},s=d({},p),H,x=null,o=0;document.addEventListener("DOMContentLoaded",()=>b(void 0,null,function*(){yield i18n.init("popup"),i18n.loadSection("options"),W(),j(),V(),v.addEventListener("change",function(){let e=v.value;s.language=e,U()})}));function V(){M.forEach(e=>{e.addEventListener("click",()=>{M.forEach(n=>n.classList.remove("active")),e.classList.add("active"),Q.forEach(n=>n.style.display="none");let t=e.getAttribute("data-tab");document.getElementById(`${t}-tab`).style.display="block"})})}function W(){chrome.storage.sync.get(["settings","pausedTimeLeft"],function(e){e.settings?(s=d(d({},p),e.settings),e.pausedTimeLeft&&s.isPaused&&(o=e.pausedTimeLeft,console.log(`\uC800\uC7A5\uB41C \uC77C\uC2DC \uC815\uC9C0 \uC2DC\uAC04 \uBCF5\uC6D0: ${Math.floor(o/1e3)}\uCD08`)),U(),Y()):chrome.storage.sync.set({settings:s})})}function U(){B(),q(),i18n.translate("popup"),i18n.translate("options"),X(s.language)}function B(){T.value=s.interval,h()}function q(){l.value=s.interval,A.checked=s.notifications,P.checked=s.exercises,v.value=s.language||"en",m.forEach(e=>{parseInt(e.dataset.value)===s.interval?e.classList.add("active"):e.classList.remove("active")}),$.forEach(e=>{let t=e.dataset.category;s.categories&&s.categories[t]!==void 0&&(e.checked=s.categories[t])}),D.value=s.workStart,O.value=s.workEnd,F.checked=s.workHoursOnly}function X(e){m.forEach(t=>{let n=t.dataset.value;n==="15"?t.textContent="15 "+(e==="ko"?"\uBD84":"min"):n==="30"?t.textContent="30 "+(e==="ko"?"\uBD84":"min"):n==="45"?t.textContent="45 "+(e==="ko"?"\uBD84":"min"):n==="60"&&(t.textContent="60 "+(e==="ko"?"\uBD84":"min"))}),h(),w(),L&&(L.textContent=i18n.get("popup","resetBtn")),r&&(r.textContent=i18n.get("options","save")),g&&(g.textContent=i18n.get("options","reset")),j()}function Y(){w(),H=setInterval(w,1e3)}function w(){chrome.alarms.get("postureReminderAlarm",e=>{if(x=e,e&&!s.isPaused){let t=new Date().getTime(),n=e.scheduledTime,u=Math.max(0,n-t),a=Math.floor(u/(60*1e3)),y=Math.floor(u%(60*1e3)/1e3);I.textContent=`${f(a)}:${f(y)}`}else if(s.isPaused&&o>0){let t=Math.floor(o/6e4),n=Math.floor(o%(60*1e3)/1e3);I.innerHTML=`
        <span class="paused">${f(t)}:${f(n)}</span>
      `}else I.textContent="00:00"})}function f(e){return e.toString().padStart(2,"0")}function h(){s.isPaused?(c.classList.add("paused"),c.textContent=i18n.get("popup","resumeBtn"),c.setAttribute("title",i18n.get("popup","resumeBtn"))):(c.classList.remove("paused"),c.textContent=i18n.get("popup","pauseBtn"),c.setAttribute("title",i18n.get("popup","pauseBtn")))}function ee(){if(s.isPaused)if(s.isPaused=!1,chrome.storage.sync.set({settings:s}),o>0){let t=o/6e4;console.log(`\uC7AC\uAC1C: \uB0A8\uC740 ${t.toFixed(2)}\uBD84\uC73C\uB85C \uC54C\uB78C \uC7AC\uC124\uC815`),chrome.runtime.sendMessage({action:"resumeAlarm",delayInMinutes:t}),o=0,chrome.storage.sync.remove("pausedTimeLeft")}else chrome.runtime.sendMessage({action:"resetAlarm"});else{if(x){let t=new Date().getTime(),n=x.scheduledTime;o=Math.max(0,n-t),console.log(`\uC77C\uC2DC \uC815\uC9C0: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(o/1e3)}\uCD08 \uC800\uC7A5\uB428`),chrome.storage.sync.set({pausedTimeLeft:o})}s.isPaused=!0,chrome.storage.sync.set({settings:s}),chrome.alarms.clear("postureReminderAlarm")}h()}function R(){s.isPaused=!1,chrome.storage.sync.set({settings:s}),chrome.runtime.sendMessage({action:"resetAlarm"}),h()}function te(){let e=parseInt(T.value);s.interval=e,l.value=e,m.forEach(t=>{parseInt(t.dataset.value)===e?t.classList.add("active"):t.classList.remove("active")}),chrome.storage.sync.set({settings:s}),s.isPaused||R()}function j(){let e=s.language||"en",t=e==="ko"?"../data/exercises_kr.json":"../data/exercises.json";console.log(`\uC2A4\uD2B8\uB808\uCE6D \uD301 \uB85C\uB4DC \uC911... \uC5B8\uC5B4: ${e}, \uD30C\uC77C: ${t}`),fetch(t).then(n=>n.json()).then(n=>{if(n.length>0){let u=Math.floor(Math.random()*n.length),a=n[u];J.textContent=a.title,K.textContent=a.description,console.log(`\uC2A4\uD2B8\uB808\uCE6D \uD301 \uB85C\uB4DC \uC644\uB8CC: ${a.title}`)}}).catch(n=>console.error("Failed to load stretching tip:",n))}function N(){let e=parseInt(l.value);isNaN(e)||e<1?e=1:e>180&&(e=180),l.value=e}function ne(){let e={};$.forEach(t=>{let n=t.dataset.category;e[n]=t.checked}),N(),s={interval:parseInt(l.value),notifications:A.checked,exercises:P.checked,language:v.value,categories:e,workStart:D.value,workEnd:O.value,workHoursOnly:F.checked,isPaused:s.isPaused},chrome.storage.sync.set({settings:s},function(){s.isPaused||chrome.runtime.sendMessage({action:"resetAlarm"}),B(),se()})}function se(){r.textContent=i18n.get("options","saved"),r.style.backgroundColor="#28a745",setTimeout(()=>{r.textContent=i18n.get("options","save"),r.style.backgroundColor="#175dce"},2e3)}function oe(){confirm(i18n.get("options","resetConfirm"))&&chrome.storage.sync.set({settings:p},function(){s=d({},p),B(),q(),chrome.runtime.sendMessage({action:"resetAlarm"}),g.textContent="Reset!",setTimeout(()=>{g.textContent=i18n.get("options","reset")},2e3)})}m.forEach(e=>{e.addEventListener("click",function(){let t=parseInt(this.dataset.value);l.value=t,m.forEach(n=>n.classList.remove("active")),this.classList.add("active")})});c.addEventListener("click",ee);L.addEventListener("click",R);T.addEventListener("change",te);l.addEventListener("change",N);r.addEventListener("click",ne);g.addEventListener("click",oe);window.addEventListener("unload",()=>{clearInterval(H)});})();
