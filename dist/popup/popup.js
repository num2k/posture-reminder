(()=>{var te=Object.defineProperty;var D=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var q=(e,t,a)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,p=(e,t)=>{for(var a in t||(t={}))ne.call(t,a)&&q(e,a,t[a]);if(D)for(var a of D(t))ae.call(t,a)&&q(e,a,t[a]);return e};var T=(e,t,a)=>new Promise((d,m)=>{var k=g=>{try{c(a.next(g))}catch(M){m(M)}},E=g=>{try{c(a.throw(g))}catch(M){m(M)}},c=g=>g.done?d(g.value):Promise.resolve(g.value).then(k,E);c((a=a.apply(e,t)).next())});var l=document.getElementById("next-reminder"),v=document.getElementById("pause-btn"),C=document.getElementById("reset-btn"),L=document.getElementById("interval-select"),se=document.getElementById("tip-title"),oe=document.getElementById("tip-description"),he=document.querySelector(".container"),i,u=document.getElementById("custom-interval"),S=document.querySelectorAll(".interval-preset"),U=document.getElementById("notifications-toggle"),O=document.getElementById("exercises-toggle"),F=document.querySelectorAll(".category-item input"),j=document.getElementById("work-start"),z=document.getElementById("work-end"),_=document.getElementById("work-hours-only"),G=document.getElementById("language-select"),f=document.getElementById("save-btn"),I=document.getElementById("reset-btn-options"),H=document.querySelectorAll(".tab-button"),re=document.querySelectorAll(".tab-content"),w={interval:5,notifications:!0,exercises:!0,language:"en",categories:{neck:!0,shoulder:!0,back:!0,wrist:!0,eye:!0,arm:!0},workStart:"09:00",workEnd:"18:00",workHoursOnly:!1,isPaused:!1,timerStarted:!1},n=p({},w),y,b=null,r=0,s,h,N=0;document.addEventListener("DOMContentLoaded",()=>T(void 0,null,function*(){yield i18n.init("popup"),i18n.loadSection("options"),ce(),de(),Y(),ue(),$()}));function $(){s&&clearInterval(s),s=setInterval(()=>{n.timerStarted&&chrome.runtime.sendMessage({action:"keepAlive"},e=>{e&&e.success&&console.log("\uC11C\uBE44\uC2A4 \uC6CC\uCEE4 \uD65C\uC131\uD654 \uC0C1\uD0DC \uC720\uC9C0 \uC911: "+new Date().toLocaleTimeString())})},15e3),h&&clearInterval(h),h=setInterval(ie,3e4)}function ie(){if(!n.timerStarted)return;let e=Date.now();e-N<25e3||(N=e,chrome.runtime.sendMessage({action:"checkNotifications"},t=>{t&&t.success?console.log(`\uC54C\uB9BC \uC0C1\uD0DC \uD655\uC778 \uC644\uB8CC: ${t.activeCount}\uAC1C \uD65C\uC131 \uC54C\uB9BC`):(console.warn("\uC54C\uB9BC \uC0C1\uD0DC \uD655\uC778 \uC2E4\uD328"),chrome.runtime.lastError&&(console.warn("\uC11C\uBE44\uC2A4 \uC6CC\uCEE4\uAC00 \uBE44\uD65C\uC131\uD654\uB41C \uAC83\uC73C\uB85C \uBCF4\uC785\uB2C8\uB2E4. \uC7AC\uD65C\uC131\uD654 \uC2DC\uB3C4 \uC911..."),chrome.runtime.sendMessage({action:"resetAlarm"})))}))}function ce(){i=document.createElement("div"),i.className="start-button-section",i.style.textAlign="center",i.style.padding="0",i.style.display="none"}function A(){let e=document.querySelector(".timer-controls");e&&(e.style.display="none"),i.innerHTML=`
    <button id="start-timer-btn" data-i18n="startTimerBtn" data-i18n-section="popup" style="background-color: #28a745; font-size: 16px; padding: 10px 20px; display:inline-block;">${i18n.get("popup","startTimerBtn")||"Start Timer"}</button>
    <p data-i18n="startTimerDesc" data-i18n-section="popup" style="margin-top: 10px; color: #777; font-size: 12px;">${i18n.get("popup","startTimerDesc")||"Click to start for posture reminder"}</p>
  `;let t=document.querySelector(".timer-display");t&&!document.querySelector(".start-button-section")&&t.parentNode.insertBefore(i,t.nextSibling),i.style.display="block",document.getElementById("start-timer-btn").addEventListener("click",le)}function K(){i&&(i.style.display="none");let e=document.querySelector(".timer-controls");e&&(e.style.display="flex")}function le(){n.timerStarted=!0,chrome.storage.sync.set({settings:n}),K();let e=n.interval||30;l.textContent=`${o(e)}:00`,chrome.runtime.sendMessage({action:"startTimer"},t=>{t&&t.success?(console.log("\uD0C0\uC774\uBA38\uAC00 \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),V(),$()):console.error("\uD0C0\uC774\uBA38 \uC2DC\uC791 \uC2E4\uD328:",t==null?void 0:t.message)})}function ue(){H.forEach(e=>{e.addEventListener("click",()=>{H.forEach(a=>a.classList.remove("active")),e.classList.add("active"),re.forEach(a=>a.style.display="none");let t=e.getAttribute("data-tab");document.getElementById(`${t}-tab`).style.display="block",t==="settings"&&J()})})}function de(){chrome.storage.sync.get(["settings","pausedTimeLeft"],function(e){e.settings?(n=p(p({},w),e.settings),e.pausedTimeLeft&&n.isPaused&&(r=e.pausedTimeLeft,console.log(`\uC800\uC7A5\uB41C \uC77C\uC2DC \uC815\uC9C0 \uC2DC\uAC04 \uBCF5\uC6D0: ${Math.floor(r/1e3)}\uCD08`)),W(),n.timerStarted?(K(),V(),$()):A()):(chrome.storage.sync.set({settings:n}),L.value=n.interval,l.innerHTML=`<span class="paused">${o(n.interval)}:00</span>`,A())})}function W(){Z(),J(),i18n.translate("popup"),i18n.translate("options"),Q(n.language)}function Z(){L.value=n.interval,B(),l.innerHTML=`<span class="paused">${o(n.interval)}:00</span>`}function x(e){S.forEach(t=>{parseInt(t.dataset.value)===e?t.classList.add("active"):t.classList.remove("active")})}function J(){u.value=n.interval,U.checked=n.notifications,O.checked=n.exercises,G.value=n.language||"en",x(n.interval),F.forEach(e=>{let t=e.dataset.category;n.categories&&n.categories[t]!==void 0&&(e.checked=n.categories[t])}),j.value=n.workStart,z.value=n.workEnd,_.checked=n.workHoursOnly}function Q(e){S.forEach(t=>{let a=t.dataset.value;a==="15"?t.textContent="15 "+(e==="ko"?"\uBD84":"min"):a==="30"?t.textContent="30 "+(e==="ko"?"\uBD84":"min"):a==="45"?t.textContent="45 "+(e==="ko"?"\uBD84":"min"):a==="60"&&(t.textContent="60 "+(e==="ko"?"\uBD84":"min"))}),B(),C&&(C.querySelector("[data-i18n='restart']").textContent=i18n.get("popup","restart")),f&&(f.textContent=i18n.get("options","save")),I&&(I.textContent=i18n.get("options","reset")),Y()}function V(){return T(this,null,function*(){y&&clearInterval(y),yield R(),y=setInterval(()=>T(this,null,function*(){yield R()}),1e3),console.log("\uD0C0\uC774\uBA38 \uC5C5\uB370\uC774\uD2B8 \uC2DC\uC791\uB428: "+new Date().toLocaleTimeString())})}function P(){s&&clearInterval(s),s=setInterval(()=>{!n.timerStarted||n.isPaused||chrome.runtime.sendMessage({action:"keepAlive"},e=>{e&&e.success?console.log("\uC11C\uBE44\uC2A4 \uC6CC\uCEE4 \uD65C\uC131\uD654 \uC0C1\uD0DC \uC720\uC9C0 \uC911: "+new Date().toLocaleTimeString()):chrome.runtime.lastError&&(console.warn("\uC11C\uBE44\uC2A4 \uC6CC\uCEE4\uC5D0 \uC5F0\uACB0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7AC\uD65C\uC131\uD654\uB97C \uC2DC\uB3C4\uD569\uB2C8\uB2E4."),chrome.runtime.sendMessage({action:"resetAlarm"}))})},15e3)}function R(){return new Promise(e=>{if(n.isPaused&&r>0){let t=Math.floor(r/1e3),a=Math.floor(t/60),d=t%60;l.innerHTML=`
        <span class="paused">${o(a)}:${o(d)}</span>
      `,e();return}if(!n.timerStarted){l.innerHTML=`<span class="paused">${o(n.interval)}:00</span>`,e();return}chrome.alarms.get("postureReminderAlarm",t=>{if(b=t,t&&!n.isPaused){let a=Date.now(),d=t.scheduledTime,m=Math.max(0,d-a),k=Math.floor(m/1e3),E=Math.floor(k/60),c=k%60;(c%30===0||c===0)&&console.log(`\uD0C0\uC774\uBA38 \uC5C5\uB370\uC774\uD2B8: ${o(E)}:${o(c)} (${new Date().toLocaleTimeString()})`),l.textContent=`${o(E)}:${o(c)}`}else l.textContent=`${o(n.interval)}:00`;e()})})}function o(e){return e.toString().padStart(2,"0")}function B(){n.isPaused?(v.classList.add("paused"),v.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","resumeBtn")):(v.classList.remove("paused"),v.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","pauseBtn"))}function me(){if(n.isPaused)if(n.isPaused=!1,chrome.storage.sync.set({settings:n}),r>0){let t=r/6e4;console.log(`\uC7AC\uAC1C: \uB0A8\uC740 ${t.toFixed(2)}\uBD84\uC73C\uB85C \uC54C\uB78C \uC7AC\uC124\uC815`),chrome.runtime.sendMessage({action:"resumeAlarm",delayInMinutes:t}),r=0,chrome.storage.sync.remove("pausedTimeLeft"),P()}else chrome.runtime.sendMessage({action:"resetAlarm"}),P();else{if(b){let t=new Date().getTime(),a=b.scheduledTime;r=Math.max(0,a-t),console.log(`\uC77C\uC2DC \uC815\uC9C0: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(r/1e3)}\uCD08 \uC800\uC7A5\uB428`),chrome.storage.sync.set({pausedTimeLeft:r})}n.isPaused=!0,chrome.storage.sync.set({settings:n}),chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),s&&(clearInterval(s),s=null)}B()}function X(){n.isPaused=!1,chrome.storage.sync.set({settings:n}),chrome.runtime.sendMessage({action:"resetAlarm"}),B(),P()}function ge(){let e=parseInt(L.value);n.interval=e,u.value=e,S.forEach(t=>{parseInt(t.dataset.value)===e?t.classList.add("active"):t.classList.remove("active")}),chrome.storage.sync.set({settings:n}),n.isPaused||(l.innerHTML=n.timerStarted?`${o(n.interval)}:00`:`<span class="paused">${o(n.interval)}:00</span>`,X())}function Y(){let t=(n.language||"en")==="ko"?"../data/exercises_kr.json":"../data/exercises.json";fetch(t).then(a=>a.json()).then(a=>{if(a.length>0){let d=Math.floor(Math.random()*a.length),m=a[d];se.textContent=m.title,oe.textContent=m.description}}).catch(a=>console.error("Failed to load stretching tip:",a))}function ee(){let e=parseInt(u.value);isNaN(e)||e<1?e=1:e>180&&(e=180),u.value=e,x(e)}function fe(){let e={};F.forEach(t=>{let a=t.dataset.category;e[a]=t.checked}),ee(),n={interval:parseInt(u.value),notifications:U.checked,exercises:O.checked,language:G.value,categories:e,workStart:j.value,workEnd:z.value,workHoursOnly:_.checked,isPaused:n.isPaused,timerStarted:n.timerStarted},chrome.storage.sync.set({settings:n},function(){!n.isPaused&&n.timerStarted&&chrome.runtime.sendMessage({action:"resetAlarm"}),Z(),x(n.interval),Q(n.language),pe()})}function pe(){f.textContent=i18n.get("options","saved"),f.style.backgroundColor="#28a745",setTimeout(()=>{f.textContent=i18n.get("options","save"),f.style.backgroundColor="#175dce"},2e3)}function ve(){confirm(i18n.get("options","resetConfirm"))&&(s&&(clearInterval(s),s=null),chrome.storage.sync.set({settings:w},function(){n=p({},w),chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),W(),A(),I.textContent="Reset!",setTimeout(()=>{I.textContent=i18n.get("options","reset")},2e3)}))}S.forEach(e=>{e.addEventListener("click",function(){let t=parseInt(this.dataset.value);u.value=t,S.forEach(a=>a.classList.remove("active")),this.classList.add("active")})});v.addEventListener("click",me);C.addEventListener("click",X);L.addEventListener("change",ge);u.addEventListener("change",ee);u.addEventListener("keyup",e=>{x(parseInt(e.target.value))});f.addEventListener("click",fe);I.addEventListener("click",ve);window.addEventListener("unload",()=>{if(y&&clearInterval(y),s&&clearInterval(s),h&&clearInterval(h),n.timerStarted&&!n.isPaused)try{chrome.runtime.sendMessage({action:"keepAlive",isClosing:!0}),chrome.runtime.sendMessage({action:"resetAlarm"})}catch(e){console.error("\uD31D\uC5C5 \uB2EB\uAE30 \uC804 \uBA54\uC2DC\uC9C0 \uC804\uC1A1 \uC2E4\uD328:",e)}});})();
