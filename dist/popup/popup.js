(()=>{var F=Object.defineProperty;var A=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var B=(t,e,i)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,I=(t,e)=>{for(var i in e||(e={}))$.call(e,i)&&B(t,i,e[i]);if(A)for(var i of A(e))_.call(e,i)&&B(t,i,e[i]);return t};var M=(t,e,i)=>(B(t,typeof e!="symbol"?e+"":e,i),i);var P=(t,e,i)=>new Promise((r,o)=>{var p=m=>{try{y(i.next(m))}catch(S){o(S)}},E=m=>{try{y(i.throw(m))}catch(S){o(S)}},y=m=>m.done?r(m.value):Promise.resolve(m.value).then(p,E);y((i=i.apply(t,e)).next())});var g={DEFAULT_INTERVAL:5,MIN_INTERVAL:1,MAX_INTERVAL:180,ZERO_DISPLAY_TIME:1e3,FEEDBACK_DISPLAY_TIME:2e3},w={interval:g.DEFAULT_INTERVAL,notifications:!0,sound:!0,soundVolume:100,exercises:!0,language:"en",categories:{neck:!0,shoulder:!0,back:!0,wrist:!0,eye:!0,arm:!0},workStart:"09:00",workEnd:"18:00",workHoursOnly:!1,isPaused:!1,timerStarted:!1},s=I({},w),l=0,f=null,n={nextReminder:document.getElementById("next-reminder"),pauseButton:document.getElementById("pause-btn"),resetButton:document.getElementById("reset-btn"),intervalSelect:document.getElementById("interval-select"),tipTitle:document.getElementById("tip-title"),tipDescription:document.getElementById("tip-description"),containerSection:document.querySelector(".container"),customIntervalInput:document.getElementById("custom-interval"),intervalPresets:document.querySelectorAll(".interval-preset"),notificationsToggle:document.getElementById("notifications-toggle"),soundToggle:document.getElementById("sound-toggle"),soundVolumeSlider:document.getElementById("sound-volume-slider"),soundVolumeValue:document.getElementById("sound-volume-value"),soundPreviewBtn:document.getElementById("sound-preview-btn"),exercisesToggle:document.getElementById("exercises-toggle"),categoryCheckboxes:document.querySelectorAll(".category-item input"),workStartInput:document.getElementById("work-start"),workEndInput:document.getElementById("work-end"),workHoursOnlyToggle:document.getElementById("work-hours-only"),languageSelect:document.getElementById("language-select"),saveButton:document.getElementById("save-btn"),resetButtonOptions:document.getElementById("reset-btn-options"),tabButtons:document.querySelectorAll(".tab-button"),tabContents:document.querySelectorAll(".tab-content")},c;function u(t){return t.toString().padStart(2,"0")}function h(t,e=0,i=!1){i?n.nextReminder.innerHTML=`<span class="paused">${u(t)}:${u(e)}</span>`:n.nextReminder.textContent=`${u(t)}:${u(e)}`}var L=class{constructor(e){M(this,"update",()=>{if(!this.isRunning||this.isPaused)return;let e=Date.now(),i=e-this.startTime,r=Math.max(0,this.duration-i),o=Math.ceil(r/1e3),p=Math.floor(o/60),E=o%60,y=Math.floor(r/1e3),m=Math.floor((e-10-this.startTime)/1e3);if(y!==m&&(this.displayTime(p,E),this.lastSecondTime=e),r<=0){this.displayTime(0,0),this.isRunning=!1,this.isFirstCycle=!1,this.animFrameId&&(cancelAnimationFrame(this.animFrameId),this.animFrameId=null),this.onComplete&&typeof this.onComplete=="function"&&setTimeout(()=>{this.onComplete()},g.ZERO_DISPLAY_TIME);return}this.animFrameId=requestAnimationFrame(this.update)});this.displayElement=e,this.startTime=0,this.duration=0,this.isRunning=!1,this.isPaused=!1,this.remainingTime=0,this.animFrameId=null,this.onComplete=null,this.lastSecondTime=0,this.isFirstCycle=!0}start(e,i){this.onComplete=i||null,this.cleanup(),this.duration=e*60*1e3,this.startTime=Date.now(),this.isRunning=!0,this.isPaused=!1,this.lastSecondTime=this.startTime,this.update(),console.log(`\uD0C0\uC774\uBA38 \uC2DC\uC791: ${e}\uBD84, \uC885\uB8CC \uC2DC\uAC04: ${new Date(this.startTime+this.duration).toLocaleTimeString()}`)}displayTime(e,i){this.displayElement&&(this.isPaused?this.displayElement.innerHTML=`<span class="paused">${u(e)}:${u(i)}</span>`:this.displayElement.textContent=`${u(e)}:${u(i)}`)}pause(){if(this.isRunning&&!this.isPaused){this.isPaused=!0;let i=Date.now()-this.startTime;this.remainingTime=Math.max(0,this.duration-i),this.cleanup();let r=Math.ceil(this.remainingTime/1e3),o=Math.floor(r/60),p=r%60;this.displayElement.innerHTML=`<span class="paused">${u(o)}:${u(p)}</span>`,console.log(`\uD0C0\uC774\uBA38 \uC77C\uC2DC\uC815\uC9C0: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(this.remainingTime/1e3)}\uCD08`)}}resume(){this.isPaused&&this.remainingTime>0&&(this.isPaused=!1,this.duration=this.remainingTime,this.startTime=Date.now(),this.lastSecondTime=this.startTime,this.isRunning=!0,this.update(),console.log(`\uD0C0\uC774\uBA38 \uC7AC\uAC1C: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(this.remainingTime/1e3)}\uCD08`))}reset(){this.cleanup(),this.isRunning=!1,this.isPaused=!1,this.remainingTime=0}cleanup(){this.animFrameId&&(cancelAnimationFrame(this.animFrameId),this.animFrameId=null)}getRemainingTime(){if(!this.isRunning&&!this.isPaused)return 0;if(this.isPaused)return this.remainingTime;let i=Date.now()-this.startTime;return Math.max(0,this.duration-i)}},a=new L(n.nextReminder);function N(){c=document.createElement("div"),c.className="start-button-section",c.style.textAlign="center",c.style.padding="0",c.style.display="none"}function k(){let t=document.querySelector(".timer-controls");t&&(t.style.display="none"),c.innerHTML=`
    <button id="start-timer-btn" data-i18n="startTimerBtn" data-i18n-section="popup" style="background-color: #28a745; font-size: 16px; padding: 10px 20px; display:inline-block;">${i18n.get("popup","startTimerBtn")||"Start Timer"}</button>
    <p data-i18n="startTimerDesc" data-i18n-section="popup" style="margin-top: 10px; color: #777; font-size: 12px;">${i18n.get("popup","startTimerDesc")||"Click to start for posture reminder"}</p>
  `;let e=document.querySelector(".timer-display");e&&!document.querySelector(".start-button-section")&&e.parentNode.insertBefore(c,e.nextSibling),c.style.display="block",document.getElementById("start-timer-btn").addEventListener("click",O)}function C(){c&&(c.style.display="none");let t=document.querySelector(".timer-controls");t&&(t.style.display="flex")}function O(){s.timerStarted=!0,s.isPaused=!1,C(),chrome.storage.sync.set({settings:s},()=>{chrome.runtime.sendMessage({action:"startTimer"},t=>{t&&t.success?(console.log("\uD0C0\uC774\uBA38\uAC00 \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),a.start(s.interval,d)):console.error("\uD0C0\uC774\uBA38 \uC2DC\uC791 \uC2E4\uD328:",t==null?void 0:t.message)})})}function d(){let t=s.interval<=1?0:s.interval-1;h(t,59,!1),chrome.runtime.sendMessage({action:"resetAlarm"},e=>{e&&e.success?(console.log(`\uC54C\uB78C \uC7AC\uC124\uC815 \uC131\uACF5, \uB2E4\uC74C \uC54C\uB78C \uC608\uC815: ${new Date(e.nextAlarmAt).toLocaleTimeString()}`),a.start(s.interval-1/60,d)):(console.error("\uC54C\uB78C \uC7AC\uC124\uC815 \uC2E4\uD328:",e==null?void 0:e.message),a.start(s.interval-1/60,d))})}function q(){if(!s.isPaused)s.isPaused=!0,a.pause(),l=a.getRemainingTime(),chrome.storage.sync.set({settings:s,pausedTimeLeft:l}),chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),v();else{if(s.isPaused=!1,chrome.storage.sync.set({settings:s}),l>0){let e=l/6e4;chrome.runtime.sendMessage({action:"resumeAlarm",delayInMinutes:e}),a.resume(),l=0,chrome.storage.sync.remove("pausedTimeLeft")}else chrome.runtime.sendMessage({action:"resetAlarm"}),a.start(s.interval,d);v()}}function b(){s.isPaused=!1,chrome.storage.sync.set({settings:s}),chrome.runtime.sendMessage({action:"resetAlarm"},t=>{t&&t.success&&(a.reset(),a.start(s.interval,d))}),v()}function H(){n.tabButtons.forEach(t=>{t.addEventListener("click",()=>{n.tabButtons.forEach(i=>i.classList.remove("active")),t.classList.add("active"),n.tabContents.forEach(i=>i.style.display="none");let e=t.getAttribute("data-tab");document.getElementById(`${e}-tab`).style.display="block",e==="settings"&&R()})})}function U(){chrome.storage.sync.get(["settings","pausedTimeLeft"],function(t){if(t.settings){if(s=I(I({},w),t.settings),t.pausedTimeLeft&&s.isPaused&&(l=t.pausedTimeLeft,console.log(`\uC800\uC7A5\uB41C \uC77C\uC2DC \uC815\uC9C0 \uC2DC\uAC04 \uBCF5\uC6D0: ${Math.floor(l/1e3)}\uCD08`)),x(),!s.timerStarted)k();else if(C(),s.timerStarted&&!s.isPaused)chrome.alarms.get("postureReminderAlarm",e=>{if(e){let i=Date.now(),o=Math.max(0,e.scheduledTime-i)/(60*1e3);a.start(o,d)}else a.start(s.interval,d)});else if(s.timerStarted&&s.isPaused&&l>0){let e=Math.floor(l/6e4),i=Math.floor(l%6e4/1e3);h(e,i,!0)}}else chrome.storage.sync.set({settings:s}),n.intervalSelect.value=s.interval,h(s.interval,0,!0),k()})}function x(){Y(),R(),i18n.translate("popup"),i18n.translate("options"),j(s.language)}function Y(){n.intervalSelect.value=s.interval,v(),!s.isPaused&&(s.timerStarted&&!s.isPaused?a.isRunning||chrome.alarms.get("postureReminderAlarm",t=>{if(t){let e=Date.now(),r=Math.max(0,t.scheduledTime-e)/(60*1e3);a.start(r,d)}else a.start(s.interval,d)}):s.timerStarted||h(s.interval,0,!0))}function T(t){n.intervalPresets.forEach(e=>{parseInt(e.dataset.value)===t?e.classList.add("active"):e.classList.remove("active")})}function R(){var t,e;n.customIntervalInput.value=s.interval,n.notificationsToggle.checked=s.notifications,n.soundToggle.checked=s.sound,n.soundVolumeSlider.value=(t=s.soundVolume)!=null?t:100,n.soundVolumeValue.textContent=(e=s.soundVolume)!=null?e:100,n.exercisesToggle.checked=s.exercises,n.languageSelect.value=s.language||"en",T(s.interval),n.categoryCheckboxes.forEach(i=>{let r=i.dataset.category;s.categories&&s.categories[r]!==void 0&&(i.checked=s.categories[r])}),n.workStartInput.value=s.workStart,n.workEndInput.value=s.workEnd,n.workHoursOnlyToggle.checked=s.workHoursOnly}function j(t){n.intervalPresets.forEach(e=>{let i=e.dataset.value;i==="15"?e.textContent="15 "+(t==="ko"?"\uBD84":"min"):i==="30"?e.textContent="30 "+(t==="ko"?"\uBD84":"min"):i==="45"?e.textContent="45 "+(t==="ko"?"\uBD84":"min"):i==="60"&&(e.textContent="60 "+(t==="ko"?"\uBD84":"min"))}),v(),n.resetButton&&(n.resetButton.querySelector("[data-i18n='restart']").textContent=i18n.get("popup","restart")),n.saveButton&&(n.saveButton.textContent=i18n.get("options","save")),n.resetButtonOptions&&(n.resetButtonOptions.textContent=i18n.get("options","reset")),D()}function v(){s.isPaused?(n.pauseButton.classList.add("paused"),n.pauseButton.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","resumeBtn")):(n.pauseButton.classList.remove("paused"),n.pauseButton.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","pauseBtn"))}function K(){let t=s.interval,e=parseInt(n.intervalSelect.value);if(s.interval=e,n.customIntervalInput.value=e,T(e),chrome.storage.sync.set({settings:s}),console.log(`\uC778\uD130\uBC8C \uBCC0\uACBD: ${t}\uBD84 \u2192 ${e}\uBD84`),s.isPaused){console.log("\uC77C\uC2DC \uC815\uC9C0 \uC0C1\uD0DC\uC5D0\uC11C \uC778\uD130\uBC8C \uBCC0\uACBD: \uB2E4\uC74C \uC0AC\uC774\uD074\uBD80\uD130 \uC801\uC6A9\uB429\uB2C8\uB2E4.");return}if(!s.timerStarted){h(s.interval,0,!0);return}b()}function X(){let t={};n.categoryCheckboxes.forEach(o=>{let p=o.dataset.category;t[p]=o.checked}),V();let e=s.interval,i=parseInt(n.customIntervalInput.value),r=e!==i;s={interval:i,notifications:n.notificationsToggle.checked,sound:n.soundToggle.checked,soundVolume:parseInt(n.soundVolumeSlider.value),exercises:n.exercisesToggle.checked,language:n.languageSelect.value,categories:t,workStart:n.workStartInput.value,workEnd:n.workEndInput.value,workHoursOnly:n.workHoursOnlyToggle.checked,isPaused:!1,timerStarted:s.timerStarted},chrome.storage.sync.set({settings:s,pausedTimeLeft:0},function(){n.intervalSelect.value=s.interval,s.timerStarted?(console.log(`\uC124\uC815 \uC800\uC7A5: \uC778\uD130\uBC8C ${s.interval}\uBD84\uC73C\uB85C \uD0C0\uC774\uBA38 \uC7AC\uC2DC\uC791`),a.reset(),chrome.runtime.sendMessage({action:"resetAlarm"},o=>{o&&o.success&&a.start(s.interval,d)}),v()):h(s.interval,0,!0),x(),Z()})}function Z(){n.saveButton.textContent=i18n.get("options","saved"),n.saveButton.style.backgroundColor="#28a745",setTimeout(()=>{n.saveButton.textContent=i18n.get("options","save"),n.saveButton.style.backgroundColor="#175dce"},g.FEEDBACK_DISPLAY_TIME)}function z(){confirm(i18n.get("options","resetConfirm"))&&(f&&(clearInterval(f),f=null),a.reset(),s=I({},w),chrome.storage.sync.set({settings:s},function(){chrome.storage.sync.remove("pausedTimeLeft"),l=0,chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),chrome.runtime.sendMessage({action:"stopTimer"}),x(),h(s.interval,0,!0),k(),n.resetButtonOptions.textContent="Reset!",setTimeout(()=>{n.resetButtonOptions.textContent=i18n.get("options","reset")},g.FEEDBACK_DISPLAY_TIME)}))}function D(){let e=(s.language||"en")==="ko"?"../data/exercises_kr.json":"../data/exercises.json";fetch(e).then(i=>i.json()).then(i=>{if(i.length>0){let r=Math.floor(Math.random()*i.length),o=i[r];n.tipTitle.textContent=o.title,n.tipDescription.textContent=o.description}}).catch(i=>console.error("Failed to load stretching tip:",i))}function V(){let t=parseInt(n.customIntervalInput.value);isNaN(t)||t<g.MIN_INTERVAL?t=g.MIN_INTERVAL:t>g.MAX_INTERVAL&&(t=g.MAX_INTERVAL),n.customIntervalInput.value=t,T(t)}function G(){!n.soundVolumeSlider||!n.soundVolumeValue||!n.soundPreviewBtn||(n.soundVolumeSlider.addEventListener("input",t=>{n.soundVolumeValue.textContent=t.target.value}),n.soundPreviewBtn.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"play-audio",play:{source:"assets/sounds/alarm.wav",volume:parseInt(n.soundVolumeSlider.value)/100},preview:!0})}))}function J(){N(),U(),D(),H(),Q(),G()}function Q(){n.pauseButton.addEventListener("click",q),n.resetButton.addEventListener("click",b),n.intervalSelect.addEventListener("change",K),n.customIntervalInput.addEventListener("change",V),n.customIntervalInput.addEventListener("keyup",t=>{T(parseInt(t.target.value))}),n.saveButton.addEventListener("click",X),n.resetButtonOptions.addEventListener("click",z),n.intervalPresets.forEach(t=>{t.addEventListener("click",function(){let e=parseInt(this.dataset.value);n.customIntervalInput.value=e,n.intervalPresets.forEach(i=>i.classList.remove("active")),this.classList.add("active")})}),window.addEventListener("unload",()=>{f&&(clearInterval(f),f=null),a&&a.reset()})}document.addEventListener("DOMContentLoaded",()=>P(void 0,null,function*(){yield i18n.init("popup"),i18n.loadSection("options"),J()}));})();
