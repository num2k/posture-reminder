(()=>{var $=Object.defineProperty;var A=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var B=(t,e,s)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,T=(t,e)=>{for(var s in e||(e={}))_.call(e,s)&&B(t,s,e[s]);if(A)for(var s of A(e))N.call(e,s)&&B(t,s,e[s]);return t};var M=(t,e,s)=>(B(t,typeof e!="symbol"?e+"":e,s),s);var P=(t,e,s)=>new Promise((r,o)=>{var h=d=>{try{y(s.next(d))}catch(S){o(S)}},E=d=>{try{y(s.throw(d))}catch(S){o(S)}},y=d=>d.done?r(d.value):Promise.resolve(d.value).then(h,E);y((s=s.apply(t,e)).next())});var g={DEFAULT_INTERVAL:5,MIN_INTERVAL:1,MAX_INTERVAL:180,ZERO_DISPLAY_TIME:1e3,FEEDBACK_DISPLAY_TIME:2e3},w={interval:g.DEFAULT_INTERVAL,notifications:!0,exercises:!0,language:"en",categories:{neck:!0,shoulder:!0,back:!0,wrist:!0,eye:!0,arm:!0},workStart:"09:00",workEnd:"18:00",workHoursOnly:!1,isPaused:!1,timerStarted:!1},n=T({},w),l=0,f=null,i={nextReminder:document.getElementById("next-reminder"),pauseButton:document.getElementById("pause-btn"),resetButton:document.getElementById("reset-btn"),intervalSelect:document.getElementById("interval-select"),tipTitle:document.getElementById("tip-title"),tipDescription:document.getElementById("tip-description"),containerSection:document.querySelector(".container"),customIntervalInput:document.getElementById("custom-interval"),intervalPresets:document.querySelectorAll(".interval-preset"),notificationsToggle:document.getElementById("notifications-toggle"),exercisesToggle:document.getElementById("exercises-toggle"),categoryCheckboxes:document.querySelectorAll(".category-item input"),workStartInput:document.getElementById("work-start"),workEndInput:document.getElementById("work-end"),workHoursOnlyToggle:document.getElementById("work-hours-only"),languageSelect:document.getElementById("language-select"),saveButton:document.getElementById("save-btn"),resetButtonOptions:document.getElementById("reset-btn-options"),tabButtons:document.querySelectorAll(".tab-button"),tabContents:document.querySelectorAll(".tab-content")},u;function c(t){return t.toString().padStart(2,"0")}function p(t,e=0,s=!1){s?i.nextReminder.innerHTML=`<span class="paused">${c(t)}:${c(e)}</span>`:i.nextReminder.textContent=`${c(t)}:${c(e)}`}var L=class{constructor(e){M(this,"update",()=>{if(!this.isRunning||this.isPaused)return;let e=Date.now(),s=e-this.startTime,r=Math.max(0,this.duration-s),o=Math.ceil(r/1e3),h=Math.floor(o/60),E=o%60,y=Math.floor(r/1e3),d=Math.floor((e-10-this.startTime)/1e3);if(y!==d&&(this.displayTime(h,E),this.lastSecondTime=e),r<=0){this.displayTime(0,0),this.isRunning=!1,this.isFirstCycle=!1,this.animFrameId&&(cancelAnimationFrame(this.animFrameId),this.animFrameId=null),this.onComplete&&typeof this.onComplete=="function"&&setTimeout(()=>{this.onComplete()},g.ZERO_DISPLAY_TIME);return}this.animFrameId=requestAnimationFrame(this.update)});this.displayElement=e,this.startTime=0,this.duration=0,this.isRunning=!1,this.isPaused=!1,this.remainingTime=0,this.animFrameId=null,this.onComplete=null,this.lastSecondTime=0,this.isFirstCycle=!0}start(e,s){this.onComplete=s||null,this.cleanup(),this.duration=e*60*1e3,this.startTime=Date.now(),this.isRunning=!0,this.isPaused=!1,this.lastSecondTime=this.startTime,this.update(),console.log(`\uD0C0\uC774\uBA38 \uC2DC\uC791: ${e}\uBD84, \uC885\uB8CC \uC2DC\uAC04: ${new Date(this.startTime+this.duration).toLocaleTimeString()}`)}displayTime(e,s){this.displayElement&&(this.isPaused?this.displayElement.innerHTML=`<span class="paused">${c(e)}:${c(s)}</span>`:this.displayElement.textContent=`${c(e)}:${c(s)}`)}pause(){if(this.isRunning&&!this.isPaused){this.isPaused=!0;let s=Date.now()-this.startTime;this.remainingTime=Math.max(0,this.duration-s),this.cleanup();let r=Math.ceil(this.remainingTime/1e3),o=Math.floor(r/60),h=r%60;this.displayElement.innerHTML=`<span class="paused">${c(o)}:${c(h)}</span>`,console.log(`\uD0C0\uC774\uBA38 \uC77C\uC2DC\uC815\uC9C0: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(this.remainingTime/1e3)}\uCD08`)}}resume(){this.isPaused&&this.remainingTime>0&&(this.isPaused=!1,this.duration=this.remainingTime,this.startTime=Date.now(),this.lastSecondTime=this.startTime,this.isRunning=!0,this.update(),console.log(`\uD0C0\uC774\uBA38 \uC7AC\uAC1C: \uB0A8\uC740 \uC2DC\uAC04 ${Math.floor(this.remainingTime/1e3)}\uCD08`))}reset(){this.cleanup(),this.isRunning=!1,this.isPaused=!1,this.remainingTime=0}cleanup(){this.animFrameId&&(cancelAnimationFrame(this.animFrameId),this.animFrameId=null)}getRemainingTime(){if(!this.isRunning&&!this.isPaused)return 0;if(this.isPaused)return this.remainingTime;let s=Date.now()-this.startTime;return Math.max(0,this.duration-s)}},a=new L(i.nextReminder);function O(){u=document.createElement("div"),u.className="start-button-section",u.style.textAlign="center",u.style.padding="0",u.style.display="none"}function k(){let t=document.querySelector(".timer-controls");t&&(t.style.display="none"),u.innerHTML=`
    <button id="start-timer-btn" data-i18n="startTimerBtn" data-i18n-section="popup" style="background-color: #28a745; font-size: 16px; padding: 10px 20px; display:inline-block;">${i18n.get("popup","startTimerBtn")||"Start Timer"}</button>
    <p data-i18n="startTimerDesc" data-i18n-section="popup" style="margin-top: 10px; color: #777; font-size: 12px;">${i18n.get("popup","startTimerDesc")||"Click to start for posture reminder"}</p>
  `;let e=document.querySelector(".timer-display");e&&!document.querySelector(".start-button-section")&&e.parentNode.insertBefore(u,e.nextSibling),u.style.display="block",document.getElementById("start-timer-btn").addEventListener("click",q)}function C(){u&&(u.style.display="none");let t=document.querySelector(".timer-controls");t&&(t.style.display="flex")}function q(){n.timerStarted=!0,n.isPaused=!1,C(),chrome.storage.sync.set({settings:n},()=>{chrome.runtime.sendMessage({action:"startTimer"},t=>{t&&t.success?(console.log("\uD0C0\uC774\uBA38\uAC00 \uC2DC\uC791\uB418\uC5C8\uC2B5\uB2C8\uB2E4."),a.start(n.interval,m)):console.error("\uD0C0\uC774\uBA38 \uC2DC\uC791 \uC2E4\uD328:",t==null?void 0:t.message)})})}function m(){let t=n.interval<=1?0:n.interval-1;p(t,59,!1),chrome.runtime.sendMessage({action:"resetAlarm"},e=>{e&&e.success?(console.log(`\uC54C\uB78C \uC7AC\uC124\uC815 \uC131\uACF5, \uB2E4\uC74C \uC54C\uB78C \uC608\uC815: ${new Date(e.nextAlarmAt).toLocaleTimeString()}`),a.start(n.interval-1/60,m)):(console.error("\uC54C\uB78C \uC7AC\uC124\uC815 \uC2E4\uD328:",e==null?void 0:e.message),a.start(n.interval-1/60,m))})}function H(){if(!n.isPaused)n.isPaused=!0,a.pause(),l=a.getRemainingTime(),chrome.storage.sync.set({settings:n,pausedTimeLeft:l}),chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),v();else{if(n.isPaused=!1,chrome.storage.sync.set({settings:n}),l>0){let e=l/6e4;chrome.runtime.sendMessage({action:"resumeAlarm",delayInMinutes:e}),a.resume(),l=0,chrome.storage.sync.remove("pausedTimeLeft")}else chrome.runtime.sendMessage({action:"resetAlarm"}),a.start(n.interval,m);v()}}function b(){n.isPaused=!1,chrome.storage.sync.set({settings:n}),chrome.runtime.sendMessage({action:"resetAlarm"},t=>{t&&t.success&&(a.reset(),a.start(n.interval,m))}),v()}function U(){i.tabButtons.forEach(t=>{t.addEventListener("click",()=>{i.tabButtons.forEach(s=>s.classList.remove("active")),t.classList.add("active"),i.tabContents.forEach(s=>s.style.display="none");let e=t.getAttribute("data-tab");document.getElementById(`${e}-tab`).style.display="block",e==="settings"&&R()})})}function V(){chrome.storage.sync.get(["settings","pausedTimeLeft"],function(t){if(t.settings){if(n=T(T({},w),t.settings),t.pausedTimeLeft&&n.isPaused&&(l=t.pausedTimeLeft,console.log(`\uC800\uC7A5\uB41C \uC77C\uC2DC \uC815\uC9C0 \uC2DC\uAC04 \uBCF5\uC6D0: ${Math.floor(l/1e3)}\uCD08`)),x(),!n.timerStarted)k();else if(C(),n.timerStarted&&!n.isPaused)chrome.alarms.get("postureReminderAlarm",e=>{if(e){let s=Date.now(),o=Math.max(0,e.scheduledTime-s)/(60*1e3);a.start(o,m)}else a.start(n.interval,m)});else if(n.timerStarted&&n.isPaused&&l>0){let e=Math.floor(l/6e4),s=Math.floor(l%6e4/1e3);p(e,s,!0)}}else chrome.storage.sync.set({settings:n}),i.intervalSelect.value=n.interval,p(n.interval,0,!0),k()})}function x(){Y(),R(),i18n.translate("popup"),i18n.translate("options"),j(n.language)}function Y(){i.intervalSelect.value=n.interval,v(),!n.isPaused&&(n.timerStarted&&!n.isPaused?a.isRunning||chrome.alarms.get("postureReminderAlarm",t=>{if(t){let e=Date.now(),r=Math.max(0,t.scheduledTime-e)/(60*1e3);a.start(r,m)}else a.start(n.interval,m)}):n.timerStarted||p(n.interval,0,!0))}function I(t){i.intervalPresets.forEach(e=>{parseInt(e.dataset.value)===t?e.classList.add("active"):e.classList.remove("active")})}function R(){i.customIntervalInput.value=n.interval,i.notificationsToggle.checked=n.notifications,i.exercisesToggle.checked=n.exercises,i.languageSelect.value=n.language||"en",I(n.interval),i.categoryCheckboxes.forEach(t=>{let e=t.dataset.category;n.categories&&n.categories[e]!==void 0&&(t.checked=n.categories[e])}),i.workStartInput.value=n.workStart,i.workEndInput.value=n.workEnd,i.workHoursOnlyToggle.checked=n.workHoursOnly}function j(t){i.intervalPresets.forEach(e=>{let s=e.dataset.value;s==="15"?e.textContent="15 "+(t==="ko"?"\uBD84":"min"):s==="30"?e.textContent="30 "+(t==="ko"?"\uBD84":"min"):s==="45"?e.textContent="45 "+(t==="ko"?"\uBD84":"min"):s==="60"&&(e.textContent="60 "+(t==="ko"?"\uBD84":"min"))}),v(),i.resetButton&&(i.resetButton.querySelector("[data-i18n='restart']").textContent=i18n.get("popup","restart")),i.saveButton&&(i.saveButton.textContent=i18n.get("options","save")),i.resetButtonOptions&&(i.resetButtonOptions.textContent=i18n.get("options","reset")),D()}function v(){n.isPaused?(i.pauseButton.classList.add("paused"),i.pauseButton.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","resumeBtn")):(i.pauseButton.classList.remove("paused"),i.pauseButton.querySelector("[data-i18n='pauseBtn']").textContent=i18n.get("popup","pauseBtn"))}function K(){let t=n.interval,e=parseInt(i.intervalSelect.value);if(n.interval=e,i.customIntervalInput.value=e,I(e),chrome.storage.sync.set({settings:n}),console.log(`\uC778\uD130\uBC8C \uBCC0\uACBD: ${t}\uBD84 \u2192 ${e}\uBD84`),n.isPaused){console.log("\uC77C\uC2DC \uC815\uC9C0 \uC0C1\uD0DC\uC5D0\uC11C \uC778\uD130\uBC8C \uBCC0\uACBD: \uB2E4\uC74C \uC0AC\uC774\uD074\uBD80\uD130 \uC801\uC6A9\uB429\uB2C8\uB2E4.");return}if(!n.timerStarted){p(n.interval,0,!0);return}b()}function X(){let t={};i.categoryCheckboxes.forEach(o=>{let h=o.dataset.category;t[h]=o.checked}),F();let e=n.interval,s=parseInt(i.customIntervalInput.value),r=e!==s;n={interval:s,notifications:i.notificationsToggle.checked,exercises:i.exercisesToggle.checked,language:i.languageSelect.value,categories:t,workStart:i.workStartInput.value,workEnd:i.workEndInput.value,workHoursOnly:i.workHoursOnlyToggle.checked,isPaused:!1,timerStarted:n.timerStarted},chrome.storage.sync.set({settings:n,pausedTimeLeft:0},function(){i.intervalSelect.value=n.interval,n.timerStarted?(console.log(`\uC124\uC815 \uC800\uC7A5: \uC778\uD130\uBC8C ${n.interval}\uBD84\uC73C\uB85C \uD0C0\uC774\uBA38 \uC7AC\uC2DC\uC791`),a.reset(),chrome.runtime.sendMessage({action:"resetAlarm"},o=>{o&&o.success&&a.start(n.interval,m)}),v()):p(n.interval,0,!0),x(),Z()})}function Z(){i.saveButton.textContent=i18n.get("options","saved"),i.saveButton.style.backgroundColor="#28a745",setTimeout(()=>{i.saveButton.textContent=i18n.get("options","save"),i.saveButton.style.backgroundColor="#175dce"},g.FEEDBACK_DISPLAY_TIME)}function z(){confirm(i18n.get("options","resetConfirm"))&&(f&&(clearInterval(f),f=null),a.reset(),n=T({},w),chrome.storage.sync.set({settings:n},function(){chrome.storage.sync.remove("pausedTimeLeft"),l=0,chrome.alarms.clear("postureReminderAlarm"),chrome.alarms.clear("postureReminderPrepare"),chrome.runtime.sendMessage({action:"stopTimer"}),x(),p(n.interval,0,!0),k(),i.resetButtonOptions.textContent="Reset!",setTimeout(()=>{i.resetButtonOptions.textContent=i18n.get("options","reset")},g.FEEDBACK_DISPLAY_TIME)}))}function D(){let e=(n.language||"en")==="ko"?"../data/exercises_kr.json":"../data/exercises.json";fetch(e).then(s=>s.json()).then(s=>{if(s.length>0){let r=Math.floor(Math.random()*s.length),o=s[r];i.tipTitle.textContent=o.title,i.tipDescription.textContent=o.description}}).catch(s=>console.error("Failed to load stretching tip:",s))}function F(){let t=parseInt(i.customIntervalInput.value);isNaN(t)||t<g.MIN_INTERVAL?t=g.MIN_INTERVAL:t>g.MAX_INTERVAL&&(t=g.MAX_INTERVAL),i.customIntervalInput.value=t,I(t)}function G(){O(),V(),D(),U(),J()}function J(){i.pauseButton.addEventListener("click",H),i.resetButton.addEventListener("click",b),i.intervalSelect.addEventListener("change",K),i.customIntervalInput.addEventListener("change",F),i.customIntervalInput.addEventListener("keyup",t=>{I(parseInt(t.target.value))}),i.saveButton.addEventListener("click",X),i.resetButtonOptions.addEventListener("click",z),i.intervalPresets.forEach(t=>{t.addEventListener("click",function(){let e=parseInt(this.dataset.value);i.customIntervalInput.value=e,i.intervalPresets.forEach(s=>s.classList.remove("active")),this.classList.add("active")})}),window.addEventListener("unload",()=>{f&&(clearInterval(f),f=null),a&&a.reset()})}document.addEventListener("DOMContentLoaded",()=>P(void 0,null,function*(){yield i18n.init("popup"),i18n.loadSection("options"),G()}));})();
